온라인 컴퓨터 시스템에서 이상 사건을 감지하는 것은 시스템을 악의적인 공격이나 기능 장애로부터 보호하는 데 중요합니다. 시스템 로그는 컴퓨터 시스템에서 발생하는 계산 이벤트에 대한 자세한 정보를 기록하며, 이상 감지에 널리 사용됩니다. 본 논문에서는 BERT(양방향 인코더 표현)를 기반으로 하는 자기지도 학습 프레임워크인 LogBERT를 제안합니다. LogBERT는 정상 로그 시퀀스의 패턴을 학습하고 이상 패턴을 감지할 수 있습니다. 실험 결과, LogBERT는 로그 데이터셋에서 최신 이상 감지 방법을 능가하는 성능을 보였습니다.

#### 1. 서론

컴퓨터 시스템은 사이버 공간에서 다양한 악의적 공격에 취약합니다. 시스템 로그는 컴퓨터 시스템에서 생성된 계산 이벤트에 대한 자세한 정보를 기록하며, 현재 이상 감지에 중요한 역할을 합니다. 전통적인 기계 학습 모델들은 로그 메시지에서 유용한 특성을 추출하고 기계 학습 알고리즘을 사용하여 로그 데이터를 분석하였습니다. 그러나 데이터 불균형 문제로 인해 이진 분류기를 훈련하는 것은 실현 가능하지 않습니다. 따라서 많은 비지도 학습 모델들이 이상을 감지하기 위해 널리 사용되고 있습니다. 하지만 전통적인 기계 학습 모델들은 이산 로그 메시지의 시간 정보를 포착하는데 어려움이 있습니다.

최근에는 심층 학습 모델, 특히 순환 신경망(RNN)이 로그 이상 감지에 널리 사용되고 있습니다. 그러나 RNN을 사용하여 로그 데이터를 모델링하는 데에는 여전히 한계가 있습니다. 이에, 본 논문에서는 BERT 모델을 활용하여 로그 시퀀스의 패턴을 포착하는 새로운 접근 방식을 제안합니다. BERT의 성공을 바탕으로, 우리는 BERT의 구조를 사용하여 각 로그 항목의 문맥 임베딩이 전체 로그 시퀀스의 정보를 포착할 수 있도록 합니다. 이를 위해 두 가지 자기지도 학습 작업을 제안합니다: 1) 마스크된 로그 키 예측, 2) 구체 부피 최소화입니다. 이 두 작업을 통해 훈련된 LogBERT는 정상 로그 시퀀스에 대한 정보를 인코딩할 수 있으며, 이를 바탕으로 이상 로그 시퀀스를 감지할 수 있습니다.

#### 2. 관련 연구

시스템 로그는 대규모 온라인 컴퓨터 시스템에서 문제 해결을 위해 널리 사용됩니다. 각 로그 메시지는 보통 반정형 텍스트 문자열로 되어 있습니다. 전통적인 접근 방식은 키워드(예: "실패")나 정규 표현식을 명시적으로 사용하여 이상 로그 항목을 감지합니다. 그러나 이러한 접근 방식은 연속된 작업의 시퀀스에서 발생하는 악의적 공격을 감지할 수 없습니다. 많은 규칙 기반 접근 방식이 이러한 도전을 해결하기 위해 제안되었으나, 이들은 높은 정확성을 달성할 수 있지만, 사전에 정의된 이상 시나리오만 식별할 수 있으며 많은 수작업을 필요로 합니다.

#### 3. LogBERT

##### 3.1 프레임워크

LogBERT는 비정형 로그 메시지의 시퀀스를 분석하여 이 시퀀스가 정상인지 이상인지를 판단합니다. 이를 위해 로그 메시지에서 로그 키(문자열 템플릿)를 추출하고, 이 로그 키들을 순서대로 배열하여 로그 시퀀스를 정의합니다. LogBERT는 정상 로그 시퀀스를 모델링하고 이를 기반으로 이상 시퀀스를 식별하는 데 사용됩니다.
![[스크린샷 2024-05-13 오후 4.16.25.png]]
##### 입력 표현

일반적인 로그 시퀀스 𝑆𝑗Sj​에 대해, 특수 토큰 DIST를 시퀀스의 시작 부분에 추가합니다. 이 토큰은 전체 로그 시퀀스를 대표하는 데 사용됩니다. LogBERT는 각 로그 키 𝑘𝑗𝑡kjt​를 입력 표현 𝑥𝑗𝑡xjt​로 나타냅니다. 이 표현은 로그 키 임베딩과 위치 임베딩의 합으로 정의됩니다.

##### 3.1 프레임워크

LogBERT는 비정형 로그 메시지의 시퀀스를 처리하여 이 시퀀스가 정상인지 아닌지를 판별합니다. 로그 메시지를 처리하기 위해 로그 파서를 사용하여 로그 메시지에서 로그 키(문자열 템플릿)를 추출하고, 이 로그 키들을 시퀀스로 정의합니다. LogBERT는 이러한 로그 키 시퀀스의 정보를 모델링하여 정상 시퀀스를 나타내고, 추후에 이를 기반으로 이상 시퀀스를 식별합니다.
![[스크린샷 2024-05-13 오후 4.17.00.png]]
#### 입력 표현

일반적인 로그 시퀀스 𝑆𝑗Sj​에 대해, 특수 토큰 DIST를 시퀀스의 시작 부분에 추가합니다. 이 토큰은 전체 로그 시퀀스를 대표하는 데 사용됩니다. LogBERT는 각 로그 키 𝑘𝑗𝑡kjt​를 입력 표현 𝑥𝑗𝑡xjt​로 나타냅니다. 이 표현은 로그 키 임베딩과 위치 임베딩의 합으로 정의됩니다.

#### 트랜스포머 인코더

LogBERT는 트랜스포머 인코더를 사용하여 로그 키의 시퀀스에서 컨텍스트 관계를 학습합니다. 각 트랜스포머 레이어는 다중 헤드 자기주의와 위치별 피드포워드 하위 레이어를 포함하며, 각 하위 레이어 주변에 잔차 연결을 사용하고 계층 정규화를 수행합니다.

#### 3.2 목표 함수

LogBERT 모델을 훈련하기 위해 두 가지 자기지도 학습 작업을 제안합니다.

- **마스크된 로그 키 예측(MLKP)**: 로그 시퀀스에서 로그 키를 무작위로 마스킹하고, 마스크된 로그 키를 예측하는 것을 목표로 합니다. 이 작업은 LogBERT가 정상 로그 시퀀스에 대한 사전 지식을 인코딩하도록 합니다.
- **구면체 부피 최소화(VHM)**: 정상 로그 시퀀스의 분포를 조절하여 임베딩 공간에서 서로 가깝게 유지하도록 하는 것을 목표로 합니다. 이를 통해 이상 시퀀스는 구의 중심에서 더 멀리 위치하게 됩니다.

#### 3.3 이상 감지

훈련 후 LogBERT를 이상 로그 시퀀스 감지에 배치합니다. LogBERT는 정상 로그 시퀀스에 대해 높은 예측 정확도를 달성할 수 있으므로, 테스트 로그 시퀀스가 정상인지 판별할 수 있습니다. 로그 시퀀스에 포함된 마스크 토큰의 예측 결과를 바탕으로 이상 점수를 계산합니다.

#### 4. 실험

##### 4.1 실험 설정

우리는 세 가지 로그 데이터셋(HDFS, BGL, Thunderbird)에서 LogBERT의 성능을 평가하였습니다. 각 데이터셋은 정상 로그 시퀀스로만 구성된 훈련 데이터셋을 바탕으로 하며, 실험 결과는 LogBERT가 기존 방법론을 능가하는 성능을 보였음을 확인했습니다.
![[스크린샷 2024-05-13 오후 4.21.20.png]]
##### 4.2 실험 결과

![[스크린샷 2024-05-13 오후 4.19.06.png]]
LogBERT는 특히 F1 점수에서 다른 모든 기준을 크게 앞질렀습니다. 이는 자기지도 학습 작업을 통해 정상 로그 시퀀스를 효과적으로 모델링하고 이를 기반으로 이상 시퀀스를 정확하게 식별할 수 있음을 보여줍니다.

#### 5. 결론

LogBERT는 로그 데이터의 이상을 감지하는 새로운 접근 방식을 제공합니다. 이 모델은 로그 시퀀스의 정상 패턴을 학습하고, 이를 기반으로 이상 시퀀스를 식별합니다. 실험 결과는 LogBERT가 로그 이상 감지 분야에서 상당한 잠재력을 가지고 있음을 보여줍니다.